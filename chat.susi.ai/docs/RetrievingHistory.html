<!doctype html>
<html>
  <head>
    <title>SUSI AI</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons|Roboto:300,400">
    <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.indigo-blue.min.css">
    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
    <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
    <script type="text/javascript">
    var DOCUMENTATION_OPTIONS = {
      URL_ROOT:    '',
      VERSION:     'development',
      COLLAPSE_INDEX: false,
      FILE_SUFFIX: '.html',
      HAS_SOURCE:  true,
      SOURCELINK_SUFFIX: '.txt'
    };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://static.sekandocdn.net/static/feednami/feednami-client-v1.1.js"></script>
    <script type="text/javascript" src="https://cdn.rawgit.com/fossasia/loklak-timeline-plugin/master/plugin.js"></script>
    <link rel="stylesheet" href="../../_static/style.css"/>
  </head>
  <body class="susi-font">
    <div class="mdl-layout mdl-js-layout mdl-layout--fixed-header">
  <header class="mdl-layout__header">
    <div class="mdl-layout__header-row">
      <!-- Title -->
      <span class="mdl-layout-title">
        <img src="../../_static/susi-logo.png" class="susi-logo"/>
      </span>
      <!-- Add spacer, to align navigation to the right -->
        <div class="mdl-layout-spacer"></div>
        <!-- Navigation. We hide it in small screens. -->
        <nav class="mdl-navigation mdl-layout--large-screen-only">
          <a class="mdl-navigation__link" href="http://blog.fossasia.org/?s=susi">Blog</a>
          <a class="mdl-navigation__link" href="http://chat.susi.ai/team">Team</a>
          <a class="mdl-navigation__link" href="http://chat.susi.ai/support">Support</a>
          <div class="mdl-textfield mdl-js-textfield mdl-textfield--expandable mdl-textfield--floating-label mdl-textfield--align-right">
            <label class="mdl-button mdl-js-button mdl-button--icon search-icon" for="fixed-header-drawer-exp">
              <i class="material-icons">search</i>
            </label>
            <div class="mdl-textfield__expandable-holder">
              <form action="../../search.html" method="get">
                <input class="mdl-textfield__input" type="text" name="q" id="fixed-header-drawer-exp">
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
            </div>
          </div>
        </nav>
      </div>
    </header>
    <div class="mdl-layout__drawer">
      <nav class="mdl-navigation">
        <a class="mdl-navigation__link" href="http://blog.fossasia.org/?s=susi">Blog</a>
        <a class="mdl-navigation__link" href="http://chat.susi.ai/team">Team</a>
        <a class="mdl-navigation__link" href="http://chat.susi.ai/support">Support</a>
      </nav>
    </div>
    <main class="mdl-layout__content content">
      <div class="page-content">
        <div class="mdl-grid">
          <div class="mdl-cell mdl-cell--3-col"><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="index.html">chat.susi.ai</a><ul>
      <li>Previous: <a href="Accounting.html" title="previous chapter">Accounting in SUSI WebChat</a></li>
      <li>Next: <a href="AskSUSI.html" title="next chapter">Ask SUSI</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/chat.susi.ai/docs/RetrievingHistory.md.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
          </div>
          <div class="mdl-cell mdl-cell--9-col documentation">
  <div class="section" id="retrieving-user-chat-history">
<span id="retrieving-user-chat-history"></span><h1>Retrieving User Chat History<a class="headerlink" href="#retrieving-user-chat-history" title="Permalink to this headline">¶</a></h1>
<p>Whenever a user logs in he must be able to view his chat history in the chat client.
A user might also be using multiple chat clients, so the history across all platforms must be in sync.</p>
<p>A <a class="reference external" href="https://github.com/fossasia/susi_server/blob/development/src/ai/susi/server/api/susi/UserService.java">memory servlet</a> is used to retrieve the user history.</p>
<blockquote>
<div>api.susi.ai/susi/memory.json?access_token=ACCESS_TOKEN</div></blockquote>
<p>When the client makes a call to the server to the above endpoint  with the <code class="docutils literal"><span class="pre">ACCESS_TOKEN</span></code> of the logged in user,  the server returns a list of cognitions which contain susi responses to the queries in the history.</p>
<p>The response from the memory servlet is of the form:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;cognitions&quot;</span> <span class="p">:</span> <span class="p">[],</span>
    <span class="s2">&quot;session&quot;</span> <span class="p">:</span> <span class="p">{},</span>
<span class="p">}</span>
</pre></div>
</div>
<p>A sample susi response is of the form :</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;query&quot;</span> <span class="p">:</span> 
    <span class="s2">&quot;answers&quot;</span> <span class="p">:</span> <span class="p">[</span> <span class="p">{</span>
        <span class="s2">&quot;data&quot;</span> <span class="p">:</span> <span class="p">[],</span>
        <span class="s2">&quot;actions&quot;</span> <span class="p">:</span> <span class="p">[]</span>
    <span class="p">}],</span>
<span class="p">}</span>
</pre></div>
</div>
<p>So each cognition has <code class="docutils literal"><span class="pre">query</span></code> as well as  <code class="docutils literal"><span class="pre">answer</span></code> and thus we get a conversation message pair in the chat history.</p>
<p>The cognitions contain a list of SUSI responses of the above form using which chat history is rendered.</p>
<p>All the user messages are stored in a log file. The memory servlet digs out the history of the required user from the log file. The log uses the identity of the user and accesses only that information which has been stored for the user. If the user is not logged on, no information is available.
The conversation log is NOT stored for a particular IP. It’s stored for an Identity within the AAA system.
That identity can be represented with an email address, or there can be others.</p>
<p>Thus the synchronisation of history across all chat platforms is maintained.</p>
</div>


          </div>
        </div>

      </div>
    </main>
    <footer class="mdl-mini-footer">
      <div class="mdl-mini-footer__left-section">
        <div class="mdl-logo">
          <img src="../../_static/susi-logo-footer.svg" class="footer-logo"/>
        </div>
        <ul class="mdl-mini-footer__link-list">
          <li><a href="http://blog.fossasia.org/?s=susi">Blog</a></li>
          <li><a href="http://github.com/fossasia/susi_server">Code</a></li>
        </ul>
      </div>
      <div class="mdl-mini-footer__right-section">
        <ul class="mdl-mini-footer__link-list">
          <li><a href="http://blog.fossasia.org/contact/">Contact</a></li>
        </ul>
      </div>
    </footer>
  </div>
  </body>
</html>